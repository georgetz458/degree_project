<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js "></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="/css/Style.css" rel="stylesheet">
    <meta charset="UTF-8">
    <title>Per Municipality</title>
</head>
<body   style="text-align: center">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Weather Analysis</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/mainStats">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/avgPerHour">Hourly</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/weatherMap">Back to Map</a>
                </li>
            </ul>
            <button class="btn btn-outline-light forGuest"  id="loginButton" style="display: none;">Login</button>
            <button class="btn btn-outline-light forAdmin"  id="logOutButton" style="display: none;">Logout</button>
        </div>
    </div>
</nav>
<H1 id="headline"></H1>
<br>
<br>
<h5>Temperature, min temperature and max temperature over time</h5>
<canvas id="tempChart"></canvas>
<br>
<br>
<h5>Temperature difference from the phone's temperature estimation over time.</h5>
<br>
<canvas id="tempDiffChart"></canvas>
<br>
<br>
<h5>Humidity percentage over time.</h5>
<br>
<canvas id="humidityChart"></canvas>
<br>
<br>
<h5>Air pressure over time.</h5>
<br>
<canvas id="airPressureChart"></canvas>
<br>
<br>
<h5>Wind speed over time.</h5>
<br>
<canvas id="windSpeedChart"></canvas>
<script th:inline="javascript">
    const queryString = location.search;
    const urlParams = new URLSearchParams(queryString);
    const municipality = urlParams.get('municipality');
    const headline = document.getElementById("headline");
    headline.innerText = 'Weather statistics for the municipality of '+municipality;


    var weatherDataPerMunicipalityList = [[${weatherDataPerMunicipalityList}]];
    const dateList = weatherDataPerMunicipalityList.map(a => a.date);
    const temperatureList = weatherDataPerMunicipalityList.map(a => a.temperature);
    const tempMaxList = weatherDataPerMunicipalityList.map(a => a.tempMax);
    const tempMinList = weatherDataPerMunicipalityList.map(a => a.tempMin);
    const tempDiffList = weatherDataPerMunicipalityList.map(a=> a.tempDiff);
    const humidityPercentageList = weatherDataPerMunicipalityList.map(a  => a.humidityPercentage);
    const airPressureList = weatherDataPerMunicipalityList.map(a => a.airPressure);
    const windSpeedList = weatherDataPerMunicipalityList.map(a => a.windSpeed);
    function createLineChart(name, labels, datasets, title) {
        const options = {

            legend: {display: true},
            plugins: {
                title: {
                    display: true,
                    text: title
                }
            },
            scales: {
                x: {
                    type: 'time'
                }

            }
        };
        new Chart(name,{
            type:"line",
            data: {
                labels: labels,
                datasets: datasets
            },
            options: options

        });

    }
    const tempListDatasets = [{
        label:'Temperature',
        fill: false,
        spanGaps: true,
        borderColor: "rgba(0,0,255,1)",
        data: temperatureList
    },
        {
            label:'Temperature Min',
            fill: false,
            spanGaps: true,
            borderColor: "rgba(128,255,0,1)",
            data: tempMinList
        },
        {
            label:'Temperature Max',
            fill: false,
            spanGaps: true,
            borderColor: "rgba(255,102,102,1)",
            data: tempMaxList
        }];
    const tempDiffListDatasets = [{
        label:'Temperature-Phone Tempersture',
        fill: false,
        borderColor: "rgba(153,76,0,1)",
        data: tempDiffList
    }];
    const humidityListDatasets = [{
        label:'Humidity',
        fill: false,
        spanGaps: true,
        borderColor: "rgba(255,102,178,1)",
        data: humidityPercentageList
    }];
    const airPressureListDatasets = [{
        label:'Pressure',
        fill: false,
        spanGaps: true,
        borderColor: "rgba(153,51,255,1)",
        data: airPressureList
    }];
    const windSpeedListDatasets = [{
        label:'Wind Speed',
        fill: false,
        spanGaps: true,
        borderColor: "rgba(255,178,102,1)",
        data: windSpeedList
    }];
    createLineChart("tempChart", dateList, tempListDatasets, 'Temperature Chart');
    createLineChart("tempDiffChart", dateList, tempDiffListDatasets, 'Difference of temperature and phone temperature estimation Chart');
    createLineChart("humidityChart", dateList, humidityListDatasets, 'Humidity percentage');
    createLineChart("airPressureChart", dateList, airPressureListDatasets, 'Air pressure Chart');
    createLineChart("windSpeedChart", dateList, windSpeedListDatasets, 'Wind speed chart');

</script>
<script type="module">
    import {} from '/js/MyFunctions.js'
    import {} from '/js/FirebaseFunctions.js'
</script>
</body>
</html>